<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geeta Sons</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. Babel to transpile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      /* Simple dark mode support for the HTML file method */
      .dark {
        background-color: #111827; /* dark:bg-gray-900 */
      }
      /* Animation for modal */
      @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      .modal-fade-in {
        animation: fadeIn 0.2s ease-out forwards;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      // The entire App.jsx code is pasted here

      // SVG Icons for better UI
      const SunIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
      );

      const MoonIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      );

      // Helper function to generate a random bill number
      const generateRandomBillNumber = () => {
        const now = new Date();
        const year = now.getFullYear().toString().slice(-2);
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const randomSuffix = Math.floor(1000 + Math.random() * 9000); // 4-digit random number
        return `${year}${month}${day}-${randomSuffix}`;
      };

      const BillHistoryModal = ({ allBills, onClose, currency, onReprint }) => {
        const [searchTerm, setSearchTerm] = React.useState('');

        const filteredBills = allBills.filter(bill => 
            bill.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
            bill.billNumber.toString().includes(searchTerm)
        ).sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by most recent date

        return (
            <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col modal-fade-in">
                    <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center">
                        <h2 className="text-xl font-bold">Bill History</h2>
                        <button onClick={onClose} className="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 text-2xl font-bold">&times;</button>
                    </div>
                    <div className="p-4">
                        <input
                            type="text"
                            placeholder="Search by customer name or bill #"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                        />
                    </div>
                    <div className="overflow-y-auto flex-grow p-4">
                        <table className="w-full border-collapse text-sm">
                            <thead>
                                <tr className="bg-gray-50 dark:bg-gray-700/50">
                                    <th className="p-2 text-left">Bill #</th>
                                    <th className="p-2 text-left">Date</th>
                                    <th className="p-2 text-left">Customer</th>
                                    <th className="p-2 text-right">Amount</th>
                                    <th className="p-2 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredBills.map(bill => (
                                    <tr key={bill.billNumber} className="hover:bg-gray-50 dark:hover:bg-gray-700/50 border-b dark:border-gray-700">
                                        <td className="p-2 font-medium">{bill.billNumber}</td>
                                        <td className="p-2">{new Date(bill.date).toLocaleString()}</td>
                                        <td className="p-2">{bill.customerName}</td>
                                        <td className="p-2 text-right font-semibold">{currency}{bill.grandTotal.toFixed(2)}</td>
                                        <td className="p-2 text-center">
                                            <button onClick={() => onReprint(bill)} className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 text-xs rounded-md">Reprint</button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {filteredBills.length === 0 && <p className="text-center text-gray-500 py-8">No matching bills found.</p>}
                    </div>
                     <div className="p-4 border-t dark:border-gray-700 text-right">
                        <button onClick={onClose} className="bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md">Close</button>
                    </div>
                </div>
            </div>
        );
      };


      const App = () => {
        const [items, setItems] = React.useState([{ id: Date.now(), name: '', quantity: 1, price: 0, total: 0 }]);
        const [customerName, setCustomerName] = React.useState('');
        const [customerPhone, setCustomerPhone] = React.useState('');
        const [billNumber, setBillNumber] = React.useState(() => generateRandomBillNumber());
        const [isInvoiceFinalized, setIsInvoiceFinalized] = React.useState(false);
        const [darkMode, setDarkMode] = React.useState(false);
        const [currency, setCurrency] = React.useState('₹');
        const [previousBalance, setPreviousBalance] = React.useState('');
        const [notification, setNotification] = React.useState(null);
        const [allBills, setAllBills] = React.useState([]);
        const [showHistory, setShowHistory] = React.useState(false);

        const customerNameRef = React.useRef();
        const itemRefs = React.useRef({});
        
        // Load saved bills on initial render
        React.useEffect(() => {
            try {
                const savedBills = JSON.parse(localStorage.getItem('geetaSonsBills')) || [];
                setAllBills(savedBills);
            } catch (error) {
                console.error("Failed to load bills from localStorage", error);
                setAllBills([]);
            }
        }, []);


        // Function to show notifications
        const showNotification = (message, type = 'error') => {
          setNotification({ message, type });
          setTimeout(() => {
            setNotification(null);
          }, 3000); // Hide after 3 seconds
        };

        const updateItemTotal = React.useCallback((id, field, value) => {
          if (isInvoiceFinalized) return;
          
          setItems(items => items.map(item => {
            if (item.id === id) {
              let updatedValue = value;
              
              if (field === 'quantity') {
                updatedValue = Math.max(1, Number(value) || 1);
              }
              
              if (field === 'price') {
                updatedValue = Math.max(0, Number(value) || 0);
              }
              
              const updatedItem = { ...item, [field]: updatedValue };
              
              if (field === 'quantity' || field === 'price') {
                updatedItem.total = updatedItem.quantity * updatedItem.price;
              }
              
              return updatedItem;
            }
            return item;
          }));
        }, [isInvoiceFinalized]);


        const handleItemKeyDown = (e, item, field) => {
          const { key } = e;
          const currentIndex = items.findIndex(i => i.id === item.id);

          const focusOnField = (itemIndex, fieldToFocus) => {
            const targetItem = items[itemIndex];
            if (targetItem) {
              const ref = itemRefs.current[`${targetItem.id}-${fieldToFocus}`];
              if (ref) {
                ref.focus();
                ref.select();
              }
            }
          };

          if (e.ctrlKey && key === 'ArrowUp' && field === 'name') {
            e.preventDefault();
            if (currentIndex > 0) {
              const previousItemName = items[currentIndex - 1].name;
              updateItemTotal(item.id, 'name', previousItemName);
            }
            return; 
          }


          if (key === 'Enter') {
            e.preventDefault();
            if (field === 'name') {
              focusOnField(currentIndex, 'quantity');
            } else if (field === 'quantity') {
              focusOnField(currentIndex, 'price');
            } else if (field === 'price') {
              if (currentIndex === items.length - 1) {
                addItem();
              } else {
                focusOnField(currentIndex + 1, 'quantity');
              }
            }
          }

          if (key === 'ArrowUp' && !e.ctrlKey) {
            e.preventDefault();
            if (currentIndex > 0) {
              focusOnField(currentIndex - 1, field);
            }
          }

          if (key === 'ArrowDown' && !e.ctrlKey) {
            e.preventDefault();
            if (currentIndex < items.length - 1) {
              focusOnField(currentIndex + 1, field);
            } else if (field !== 'name') {
              addItem();
            }
          }
        };

        React.useEffect(() => {
          if (customerNameRef.current) {
            customerNameRef.current.focus();
          }
        }, []);
        
        React.useEffect(() => {
          if (darkMode) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        }, [darkMode]);


        const addItem = React.useCallback(() => {
          if (isInvoiceFinalized) return;
          
          const newItemId = Date.now();
          const newItem = { id: newItemId, name: '', quantity: 1, price: 0, total: 0 };
          setItems(prev => [...prev, newItem]);
          
          setTimeout(() => {
            if (itemRefs.current[`${newItemId}-quantity`]) {
              const ref = itemRefs.current[`${newItemId}-quantity`];
              ref.focus();
              ref.select();
            }
          }, 50);
        }, [isInvoiceFinalized]);

        const addItemAndFocusPrice = React.useCallback(() => {
          if (isInvoiceFinalized) return;
          
          const newItemId = Date.now();
          const newItem = { id: newItemId, name: '', quantity: 1, price: 0, total: 0 };
          setItems(prev => [...prev, newItem]);
          
          setTimeout(() => {
            const ref = itemRefs.current[`${newItemId}-price`];
            if (ref) {
              ref.focus();
              ref.select();
            }
          }, 50);
        }, [isInvoiceFinalized]);


        const removeItem = React.useCallback((id) => {
          if (isInvoiceFinalized) return;
          
          if (items.length > 1) {
            setItems(prev => prev.filter(item => item.id !== id));
          }
        }, [items.length, isInvoiceFinalized]);

        const itemsTotal = items.reduce((sum, item) => sum + item.total, 0);
        const grandTotal = itemsTotal + Number(previousBalance || 0);

        const finalizeInvoice = React.useCallback(() => {
          if (itemsTotal <= 0 && Number(previousBalance || 0) <= 0) {
            showNotification("Please add items or a previous balance before finalizing.");
            return;
          }
          setIsInvoiceFinalized(true);
        }, [itemsTotal, previousBalance]);
        
        const sendPrintRequest = async (receiptData) => {
             try {
                const response = await fetch('http://localhost:4000/print', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(receiptData),
                });

                if (response.ok) {
                    showNotification(`Bill #${receiptData.billNumber} sent to printer!`, "success");
                    return true;
                } else {
                    const error = await response.json();
                    showNotification(`Print Error: ${error.message}`);
                    return false;
                }
            } catch (error) {
                console.error('Print server connection error:', error);
                showNotification('Print server not running. Please start the helper app.');
                return false;
            }
        };

        const printInvoice = React.useCallback(async () => {
            if (grandTotal <= 0) {
                showNotification("Cannot print an empty invoice.");
                return;
            }

            const receiptData = {
                billNumber: billNumber,
                date: new Date().toISOString(),
                customerName: customerName || 'Walk-in Customer',
                customerPhone: customerPhone,
                items: items.filter(item => item.price > 0),
                itemsTotal: itemsTotal,
                previousBalance: Number(previousBalance || 0),
                grandTotal: grandTotal,
                currency: currency,
            };

            const printed = await sendPrintRequest(receiptData);

            if (printed) {
                const updatedBills = [...allBills, receiptData];
                localStorage.setItem('geetaSonsBills', JSON.stringify(updatedBills));
                setAllBills(updatedBills);

                setTimeout(() => {
                    generateNewBill();
                }, 1500);
            }

        }, [grandTotal, billNumber, currency, items, itemsTotal, previousBalance, customerName, customerPhone, allBills]);

        const handleReprint = async (billToReprint) => {
            showNotification(`Reprinting Bill #${billToReprint.billNumber}...`, 'success');
            await sendPrintRequest(billToReprint);
        };

        const generateNewBill = React.useCallback(() => {
          setIsInvoiceFinalized(false);
          setBillNumber(generateRandomBillNumber());
          setCustomerName('');
          setCustomerPhone('');
          setItems([{ id: Date.now(), name: '', quantity: 1, price: 0, total: 0 }]);
          setPreviousBalance('');
          
          setTimeout(() => {
            if (customerNameRef.current) {
              customerNameRef.current.focus();
            }
          }, 100);
        }, []);

        React.useEffect(() => {
          const handleKeyDown = (e) => {
            // Priority shortcut: '+' to add item and focus price
            if (e.key === '+' || e.key === '=') {
              e.preventDefault();
              addItemAndFocusPrice();
              return;
            }
            
            if (e.ctrlKey && e.key === 'Enter') {
              e.preventDefault();
              addItem();
            }
            if (e.ctrlKey && e.shiftKey && (e.key === 'N' || e.key === 'n')) {
              e.preventDefault();
              generateNewBill();
            }
            if (e.key === 'Escape') {
              if (showHistory) {
                  setShowHistory(false);
              } else if (customerNameRef.current) {
                customerNameRef.current.focus();
              }
            }
            if (e.ctrlKey && (e.key === 'f' || e.key === 'F')) {
              e.preventDefault();
              if(!isInvoiceFinalized) finalizeInvoice();
            }
            if (e.ctrlKey && (e.key === 'p' || e.key === 'P')) {
              e.preventDefault();
              if(isInvoiceFinalized) printInvoice();
            }
          };

          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [addItem, generateNewBill, finalizeInvoice, printInvoice, isInvoiceFinalized, showHistory, addItemAndFocusPrice]);

        return (
          <>
            {showHistory && <BillHistoryModal allBills={allBills} onClose={() => setShowHistory(false)} currency={currency} onReprint={handleReprint} />}
            
            <div className="min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-2 sm:p-4 transition-colors duration-300">
                <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="bg-white dark:bg-gray-800 rounded-t-lg shadow-lg p-4 mb-4">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h1 className="text-3xl font-bold text-blue-600 dark:text-blue-400">Geeta Sons</h1>
                    </div>
                    <div className="flex items-center gap-2">
                        <button onClick={() => setShowHistory(true)} className="bg-gray-200 dark:bg-gray-700 text-sm font-medium px-3 py-1.5 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">
                            View History
                        </button>
                        <div className="bg-gray-200 dark:bg-gray-700 p-1 rounded-full flex items-center">
                            <button onClick={() => setDarkMode(false)} className={`p-1.5 rounded-full transition-colors ${!darkMode ? 'bg-white shadow' : 'text-gray-500'}`}><SunIcon /></button>
                            <button onClick={() => setDarkMode(true)} className={`p-1.5 rounded-full transition-colors ${darkMode ? 'bg-gray-900 text-white shadow' : 'text-gray-500'}`}><MoonIcon /></button>
                        </div>
                        <div className="bg-green-100 dark:bg-green-900/50 px-3 py-1.5 rounded-full">
                        <span className="text-green-800 dark:text-green-300 font-medium">Bill #{billNumber}</span>
                        </div>
                        {isInvoiceFinalized && (
                        <div className="bg-purple-100 dark:bg-purple-900/50 px-3 py-1.5 rounded-full">
                            <span className="text-purple-800 dark:text-purple-300 font-medium">FINALIZED</span>
                        </div>
                        )}
                    </div>
                    </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-4 gap-4">
                    {/* Left Column */}
                    <div className="lg:col-span-1 flex flex-col gap-4">
                    {/* Customer Info */}
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                        <h3 className="font-bold text-lg mb-3">Customer Info</h3>
                        <div className="space-y-3">
                        <input
                            ref={customerNameRef}
                            type="text"
                            value={customerName}
                            onChange={(e) => setCustomerName(e.target.value)}
                            className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            placeholder="Customer name (optional)"
                            autoFocus
                            disabled={isInvoiceFinalized}
                        />
                        <input
                            type="tel"
                            value={customerPhone}
                            onChange={(e) => setCustomerPhone(e.target.value)}
                            className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            placeholder="Phone number (optional)"
                            disabled={isInvoiceFinalized}
                        />
                        </div>
                    </div>

                    {/* Action Buttons */}
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 space-y-3">
                        <button
                        onClick={finalizeInvoice}
                        disabled={isInvoiceFinalized || (itemsTotal <= 0 && Number(previousBalance || 0) <= 0)}
                        className="w-full py-3 px-4 rounded-md font-bold text-white transition-all duration-200 disabled:bg-gray-400 disabled:dark:bg-gray-600 disabled:cursor-not-allowed bg-purple-500 hover:bg-purple-600 transform hover:scale-105"
                        >
                        ✅ Finalize Invoice (Ctrl+F)
                        </button>
                        <button
                        onClick={printInvoice}
                        disabled={!isInvoiceFinalized}
                        className="w-full py-3 px-4 rounded-md font-bold text-white transition-all duration-200 disabled:bg-gray-400 disabled:dark:bg-gray-600 disabled:cursor-not-allowed bg-green-600 hover:bg-green-700 transform hover:scale-105"
                        >
                        🖨️ Print & New (Ctrl+P)
                        </button>
                        <button
                        onClick={generateNewBill}
                        className="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-md font-bold transition-all duration-200 transform hover:scale-105"
                        >
                        ➕ New Bill (Ctrl+Shift+N)
                        </button>
                    </div>
                    
                    {/* Settings */}
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                        <h3 className="font-bold text-lg mb-3">Settings</h3>
                        <div className="space-y-3">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Currency</label>
                            <select
                            value={currency}
                            onChange={(e) => setCurrency(e.target.value)}
                            className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            disabled={isInvoiceFinalized}
                            >
                            <option value="₹">INR (₹)</option>
                            <option value="$">USD ($)</option>
                            <option value="€">EUR (€)</option>
                            <option value="£">GBP (£)</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Previous Balance (Optional)</label>
                            <input
                            type="text"
                            value={previousBalance}
                            onChange={(e) => {
                                const val = e.target.value;
                                if (/^\d*\.?\d*$/.test(val)) {
                                setPreviousBalance(val);
                                }
                            }}
                            className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            placeholder="Enter previous due"
                            disabled={isInvoiceFinalized}
                            />
                        </div>
                        </div>
                    </div>

                    {/* Shortcuts */}
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                        <h3 className="font-bold text-lg mb-3">Shortcuts</h3>
                        <ul className="space-y-2 text-sm">
                            {[
                                { key: '+', action: 'Add & Go to Price' },
                                { key: 'Ctrl + Enter', action: 'Add New Item' },
                                { key: 'Ctrl + ↑', action: 'Copy Name Above' },
                                { key: 'Enter', action: 'Next Field' },
                                { key: '↑ / ↓', action: 'Navigate Rows' },
                                { key: 'Ctrl + F', action: 'Finalize Bill' },
                                { key: 'Ctrl + P', action: 'Print Bill' },
                                { key: 'Ctrl + Shift + N', action: 'New Bill' },
                                { key: 'Esc', action: 'Focus/Close' },
                            ].map(shortcut => (
                                <li key={shortcut.action} className="flex justify-between items-center text-gray-600 dark:text-gray-400">
                                    <span>{shortcut.action}</span>
                                    <kbd className="px-2 py-1 text-xs font-semibold text-gray-700 bg-gray-100 dark:bg-gray-900 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md">
                                        {shortcut.key}
                                    </kbd>
                                </li>
                            ))}
                        </ul>
                    </div>
                    </div>

                    {/* Billing Table */}
                    <div className="lg:col-span-3">
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                        <div className="flex justify-between items-center mb-4">
                        <h2 className="text-xl font-bold">Items</h2>
                        <button
                            onClick={addItem}
                            disabled={isInvoiceFinalized}
                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            + Add Item (Ctrl+Enter)
                        </button>
                        </div>

                        <div className="overflow-x-auto">
                        <table className="w-full border-collapse text-sm">
                            <thead>
                            <tr className="bg-gray-50 dark:bg-gray-700/50">
                                <th className="border-b dark:border-gray-700 p-2 text-left">#</th>
                                <th className="border-b dark:border-gray-700 p-2 text-left w-2/5">Name</th>
                                <th className="border-b dark:border-gray-700 p-2 text-center">Qty</th>
                                <th className="border-b dark:border-gray-700 p-2 text-right">Price</th>
                                <th className="border-b dark:border-gray-700 p-2 text-right">Total</th>
                                <th className="border-b dark:border-gray-700 p-2 text-center">Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            {items.map((item, index) => (
                                <tr key={item.id} className="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                <td className="border-b dark:border-gray-700 p-2 font-medium">{index + 1}</td>
                                <td className="border-b dark:border-gray-700 p-1">
                                    <input
                                    ref={el => itemRefs.current[`${item.id}-name`] = el}
                                    type="text"
                                    value={item.name}
                                    onChange={(e) => updateItemTotal(item.id, 'name', e.target.value)}
                                    onKeyDown={(e) => handleItemKeyDown(e, item, 'name')}
                                    className="w-full p-1 bg-transparent border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                                    placeholder="Product name"
                                    disabled={isInvoiceFinalized}
                                    />
                                </td>
                                <td className="border-b dark:border-gray-700 p-1">
                                    <input
                                    ref={el => itemRefs.current[`${item.id}-quantity`] = el}
                                    type="number"
                                    min="1"
                                    value={item.quantity}
                                    onChange={(e) => updateItemTotal(item.id, 'quantity', e.target.value)}
                                    onKeyDown={(e) => handleItemKeyDown(e, item, 'quantity')}
                                    onFocus={(e) => e.target.select()}
                                    className="w-16 p-1 bg-transparent border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 text-center"
                                    disabled={isInvoiceFinalized}
                                    />
                                </td>
                                <td className="border-b dark:border-gray-700 p-1">
                                    <input
                                    ref={el => itemRefs.current[`${item.id}-price`] = el}
                                    type="number"
                                    min="0"
                                    step="0.01"
                                    value={item.price}
                                    onChange={(e) => updateItemTotal(item.id, 'price', e.target.value)}
                                    onKeyDown={(e) => handleItemKeyDown(e, item, 'price')}
                                    onFocus={(e) => e.target.select()}
                                    className="w-24 p-1 bg-transparent border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 text-right"
                                    disabled={isInvoiceFinalized}
                                    />
                                </td>
                                <td className="border-b dark:border-gray-700 p-2 font-medium text-right">
                                    {currency}{item.total.toFixed(2)}
                                </td>
                                <td className="border-b dark:border-gray-700 p-2 text-center">
                                    <button
                                    onClick={() => removeItem(item.id)}
                                    className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded-full text-xs font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                    disabled={items.length <= 1 || isInvoiceFinalized}
                                    >
                                    ✕
                                    </button>
                                </td>
                                </tr>
                            ))}
                            </tbody>
                        </table>
                        </div>

                        {/* Summary */}
                        <div className="mt-4 bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border-t-2 border-blue-500 dark:border-blue-400">
                        <div className="flex justify-between items-start">
                            <div className="text-sm text-gray-500 dark:text-gray-400">
                            <p>Items: {items.length}</p>
                            <p>Customer: {customerName || 'Walk-in Customer'}</p>
                            </div>
                            <div className="text-right space-y-2">
                            <div className="text-lg">
                                <span className="text-gray-500 dark:text-gray-400">Current Bill: </span>
                                <span className="font-semibold">{currency}{itemsTotal.toFixed(2)}</span>
                            </div>
                            <div className="text-lg">
                                <span className="text-gray-500 dark:text-gray-400">Previous Due: </span>
                                <span className="font-semibold">{currency}{Number(previousBalance || 0).toFixed(2)}</span>
                            </div>
                            <hr className="border-gray-300 dark:border-gray-600"/>
                            <div className="text-3xl font-bold text-green-600 dark:text-green-400">
                                {currency}{grandTotal.toFixed(2)}
                            </div>
                            <div className="text-sm text-gray-500 dark:text-gray-400 -mt-1">Grand Total</div>
                            </div>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
                </div>
                
                {/* Notification Toast */}
                {notification && (
                <div className={`fixed bottom-5 left-1/2 -translate-x-1/2 text-white py-2 px-4 rounded-lg shadow-lg animate-bounce ${notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'}`}>
                    {notification.message}
                </div>
                )}

                {/* Status indicator */}
                <div className="fixed bottom-4 right-4 bg-white dark:bg-gray-800 rounded-full p-3 shadow-lg border border-gray-200 dark:border-gray-700">
                <div className="flex items-center gap-2">
                    <div className={`w-3 h-3 rounded-full transition-colors ${
                    isInvoiceFinalized ? 'bg-green-500 animate-pulse' : 'bg-blue-500'
                    }`}></div>
                    <div className="text-xs">
                    {isInvoiceFinalized ? 'Ready to Print' : 'Editing Bill'}
                    </div>
                </div>
                </div>
            </div>
          </>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>

