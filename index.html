<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geeta Sons (QR Sync)</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. Babel to transpile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-qr-scanner@1.0.8/qr-scanner.umd.min.js"></script>

    <style>
      .dark { background-color: #111827; }
      @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
      .modal-fade-in { animation: fadeIn 0.2s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useCallback } = React;
      
      const SunIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>);
      const MoonIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-5 w-5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>);

      const generateRandomBillNumber = () => {
        const now = new Date();
        const year = now.getFullYear().toString().slice(-2);
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const randomSuffix = Math.floor(1000 + Math.random() * 9000);
        return `${year}${month}${day}-${randomSuffix}`;
      };

      const QRCodeComponent = ({ value, size }) => {
        const [dataUrl, setDataUrl] = useState('');
        useEffect(() => {
          if (value && window.QRious) {
            const qr = new window.QRious({ value, size });
            setDataUrl(qr.toDataURL());
          }
        }, [value, size]);

        if (!dataUrl) return <div style={{ width: size, height: size }} className="flex items-center justify-center bg-gray-100 rounded-md"><p>Generating...</p></div>;
        return <img src={dataUrl} alt="Bill Data QR Code" />;
      };
      
      const BillHistoryModal = ({ allBills, onClose, currency, onReprint }) => {
        const [searchTerm, setSearchTerm] = useState('');
        const filteredBills = allBills.filter(bill => 
            bill.customerName.toLowerCase().includes(searchTerm.toLowerCase()) ||
            bill.billNumber.toString().includes(searchTerm)
        ).sort((a, b) => new Date(b.date) - new Date(a.date));

        return (
            <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col modal-fade-in">
                    <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center"><h2 className="text-xl font-bold">Bill History</h2><button onClick={onClose} className="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 text-2xl font-bold">&times;</button></div>
                    <div className="p-4"><input type="text" placeholder="Search by customer name or bill #" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"/></div>
                    <div className="overflow-y-auto flex-grow p-4">
                        <table className="w-full border-collapse text-sm">
                            <thead><tr className="bg-gray-50 dark:bg-gray-700/50"><th className="p-2 text-left">Bill #</th><th className="p-2 text-left">Date</th><th className="p-2 text-left">Customer</th><th className="p-2 text-right">Amount</th><th className="p-2 text-center">Action</th></tr></thead>
                            <tbody>
                                {filteredBills.map(bill => (
                                    <tr key={bill.id || bill.billNumber} className="hover:bg-gray-50 dark:hover:bg-gray-700/50 border-b dark:border-gray-700">
                                        <td className="p-2 font-medium">{bill.billNumber}</td>
                                        <td className="p-2">{new Date(bill.date).toLocaleString()}</td>
                                        <td className="p-2">{bill.customerName}</td>
                                        <td className="p-2 text-right font-semibold">{currency}{bill.grandTotal.toFixed(2)}</td>
                                        <td className="p-2 text-center"><button onClick={() => onReprint(bill)} className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 text-xs rounded-md">Reprint</button></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {filteredBills.length === 0 && <p className="text-center text-gray-500 py-8">No matching bills found.</p>}
                    </div>
                     <div className="p-4 border-t dark:border-gray-700 text-right"><button onClick={onClose} className="bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md">Close</button></div>
                </div>
            </div>
        );
      };

      const App = () => {
        const [items, setItems] = useState([{ id: Date.now(), name: '', quantity: 1, price: 0, total: 0 }]);
        const [customerName, setCustomerName] = useState('');
        const [customerPhone, setCustomerPhone] = useState('');
        const [billNumber, setBillNumber] = useState(() => generateRandomBillNumber());
        const [isInvoiceFinalized, setIsInvoiceFinalized] = useState(false);
        const [darkMode, setDarkMode] = useState(false);
        const [currency, setCurrency] = useState('₹');
        const [previousBalance, setPreviousBalance] = useState('');
        const [notification, setNotification] = useState(null);
        const [allBills, setAllBills] = useState([]);
        const [showHistory, setShowHistory] = useState(false);
        const [qrCodeData, setQrCodeData] = useState(null);
        const [isScanning, setIsScanning] = useState(false);

        const customerNameRef = useRef();
        const itemRefs = useRef({});
        const videoRef = useRef(null);
        const qrScannerRef = useRef(null);

        useEffect(() => {
            const savedBills = JSON.parse(localStorage.getItem('geetaSonsBills')) || [];
            setAllBills(savedBills);
        }, []);

        const showNotification = (message, type = 'error') => {
            setNotification({ message, type });
            setTimeout(() => setNotification(null), 3000);
        };

        const stopScanning = useCallback(() => {
            if (qrScannerRef.current) {
                qrScannerRef.current.stop();
                qrScannerRef.current.destroy();
                qrScannerRef.current = null;
            }
            setIsScanning(false);
        }, []);

        useEffect(() => {
            if (isScanning && videoRef.current) {
                const qrScanner = new window.QrScanner(
                    videoRef.current,
                    result => {
                        try {
                            const bill = JSON.parse(result.data);
                            if (bill && bill.billNumber && bill.items) {
                                setAllBills(prevBills => {
                                    const updatedBills = [...prevBills, bill];
                                    localStorage.setItem('geetaSonsBills', JSON.stringify(updatedBills));
                                    return updatedBills;
                                });
                                showNotification(`Successfully imported Bill #${bill.billNumber}`, 'success');
                                stopScanning();
                            }
                        } catch (e) {
                            showNotification('Invalid QR code scanned.');
                            stopScanning();
                        }
                    },
                    { highlightScanRegion: true, highlightCodeOutline: true }
                );
                qrScanner.start().catch(err => {
                    console.error("QR Scanner Error:", err);
                    showNotification("Camera access failed. Please grant permission.");
                    stopScanning();
                });
                qrScannerRef.current = qrScanner;
            }
            return () => { // Cleanup function
                if(qrScannerRef.current) {
                    qrScannerRef.current.stop();
                }
            };
        }, [isScanning, stopScanning]);
        
        const generateQrCode = useCallback(() => {
            const currentTotal = items.reduce((sum, item) => sum + item.total, 0);
            const finalGrandTotal = currentTotal + Number(previousBalance || 0);

            if (finalGrandTotal <= 0) {
                showNotification("Cannot generate QR for an empty bill.");
                return;
            }
             const receiptData = { 
                id: Date.now(), billNumber, date: new Date().toISOString(),
                customerName: customerName || 'Walk-in Customer', customerPhone,
                items: items.filter(i => i.price > 0), itemsTotal: currentTotal,
                previousBalance: Number(previousBalance || 0), grandTotal: finalGrandTotal, currency
            };
            setQrCodeData(JSON.stringify(receiptData));
        }, [billNumber, customerName, customerPhone, items, previousBalance, currency]);

        const itemsTotal = items.reduce((sum, item) => sum + item.total, 0);
        const grandTotal = itemsTotal + Number(previousBalance || 0);
        
        const sendPrintRequest = async (receiptData) => { /* ... same as before ... */ };
        const generateNewBill = useCallback(() => { /* ... same as before ... */ }, []);
        const printInvoice = useCallback(async () => { /* ... same as before ... */ }, []);
        const updateItemTotal = useCallback((id, field, value) => { /* ... same as before ... */ }, []);
        const handleItemKeyDown = (e, item, field) => { /* ... same as before ... */ };
        const addItem = useCallback(() => { /* ... same as before ... */ }, []);
        const addItemAndFocusPrice = useCallback(() => { /* ... same as before ... */ }, []);
        const removeItem = useCallback((id) => { /* ... same as before ... */ }, []);
        const finalizeInvoice = useCallback(() => { /* ... same as before ... */ }, []);
        const handleReprint = async (billToReprint) => { /* ... same as before ... */ };
        
        useEffect(() => { document.documentElement.classList.toggle('dark', darkMode); }, [darkMode]);
        useEffect(() => {
          const handleKeyDown = (e) => {
            if (isScanning || qrCodeData) {
                if(e.key === 'Escape') { stopScanning(); setQrCodeData(null); }
                return;
            }
            if (e.key === '+' || e.key === '=') { e.preventDefault(); addItemAndFocusPrice(); return; }
            if (e.ctrlKey && e.key === 'Enter') { e.preventDefault(); addItem(); }
            if (e.ctrlKey && e.shiftKey && (e.key === 'N' || e.key === 'n')) { e.preventDefault(); generateNewBill(); }
            if (e.key === 'Escape') {
              if (showHistory) setShowHistory(false);
              else if (customerNameRef.current) customerNameRef.current.focus();
            }
            if (e.ctrlKey && (e.key === 'f' || e.key === 'F')) { e.preventDefault(); if(!isInvoiceFinalized) finalizeInvoice(); }
            if (e.ctrlKey && (e.key === 'p' || e.key === 'P')) { e.preventDefault(); if(isInvoiceFinalized) printInvoice(); }
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [addItem, generateNewBill, finalizeInvoice, printInvoice, isInvoiceFinalized, showHistory, qrCodeData, isScanning, addItemAndFocusPrice]);


        return (
          <>
            {showHistory && <BillHistoryModal allBills={allBills} onClose={() => setShowHistory(false)} currency={currency} onReprint={handleReprint} />}
            {qrCodeData && (
                <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50">
                    <div className="bg-white dark:bg-gray-800 rounded-lg p-6 text-center modal-fade-in">
                        <h2 className="text-xl font-bold mb-4">Scan to Transfer Bill</h2>
                        <div className="flex justify-center"><QRCodeComponent value={qrCodeData} size={256} /></div>
                        <button onClick={() => setQrCodeData(null)} className="mt-6 bg-blue-500 text-white px-6 py-2 rounded-md">Done</button>
                    </div>
                </div>
            )}
            {isScanning && (
                <div className="fixed inset-0 bg-black/80 flex flex-col items-center justify-center z-50">
                    <video ref={videoRef} className="w-full max-w-md h-auto rounded-lg shadow-2xl"></video>
                    <button onClick={stopScanning} className="mt-4 bg-red-500 text-white px-6 py-2 rounded-md">Cancel Scan</button>
                </div>
            )}
            <div className="min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-2 sm:p-4">
                <div className="max-w-7xl mx-auto">
                    <div className="bg-white dark:bg-gray-800 rounded-t-lg shadow-lg p-4 mb-4">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div><h1 className="text-3xl font-bold text-blue-600 dark:text-blue-400">Geeta Sons</h1></div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => setIsScanning(true)} className="bg-green-500 text-white text-sm font-medium px-3 py-1.5 rounded-full hover:bg-green-600">Scan Bill</button>
                                <button onClick={() => setShowHistory(true)} className="bg-gray-200 dark:bg-gray-700 text-sm font-medium px-3 py-1.5 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600">View History</button>
                                <div className="bg-gray-200 dark:bg-gray-700 p-1 rounded-full flex items-center">
                                    <button onClick={() => setDarkMode(false)} className={`p-1.5 rounded-full transition-colors ${!darkMode ? 'bg-white shadow' : 'text-gray-500'}`}><SunIcon /></button>
                                    <button onClick={() => setDarkMode(true)} className={`p-1.5 rounded-full transition-colors ${darkMode ? 'bg-gray-900 text-white shadow' : 'text-gray-500'}`}><MoonIcon /></button>
                                </div>
                                <div className="bg-green-100 dark:bg-green-900/50 px-3 py-1.5 rounded-full"><span className="text-green-800 dark:text-green-300 font-medium">Bill #{billNumber}</span></div>
                                {isInvoiceFinalized && (<div className="bg-purple-100 dark:bg-purple-900/50 px-3 py-1.5 rounded-full"><span className="text-purple-800 dark:text-purple-300 font-medium">FINALIZED</span></div>)}
                            </div>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-4 gap-4">
                        <div className="lg:col-span-1 flex flex-col gap-4">
                            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                                <h3 className="font-bold text-lg mb-3">Customer Info</h3>
                                <div className="space-y-3">
                                    <input ref={customerNameRef} type="text" value={customerName} onChange={(e) => setCustomerName(e.target.value)} className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="Customer name (optional)" autoFocus disabled={isInvoiceFinalized} />
                                    <input type="tel" value={customerPhone} onChange={(e) => setCustomerPhone(e.target.value)} className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="Phone number (optional)" disabled={isInvoiceFinalized} />
                                </div>
                            </div>
                            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 space-y-3">
                                <button onClick={finalizeInvoice} disabled={isInvoiceFinalized || (itemsTotal <= 0 && Number(previousBalance || 0) <= 0)} className="w-full py-3 px-4 rounded-md font-bold text-white transition-all duration-200 disabled:bg-gray-400 disabled:dark:bg-gray-600 disabled:cursor-not-allowed bg-purple-500 hover:bg-purple-600 transform hover:scale-105">✅ Finalize Invoice (Ctrl+F)</button>
                                <button onClick={printInvoice} disabled={!isInvoiceFinalized} className="w-full py-3 px-4 rounded-md font-bold text-white transition-all duration-200 disabled:bg-gray-400 disabled:dark:bg-gray-600 disabled:cursor-not-allowed bg-green-600 hover:bg-green-700 transform hover:scale-105">🖨️ Print & New (Ctrl+P)</button>
                                <button onClick={generateQrCode} disabled={!isInvoiceFinalized} className="w-full py-3 px-4 rounded-md font-bold text-white transition-all duration-200 disabled:bg-gray-400 disabled:dark:bg-gray-600 disabled:cursor-not-allowed bg-indigo-600 hover:bg-indigo-700 transform hover:scale-105">📱 Generate QR</button>
                                <button onClick={generateNewBill} className="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-md font-bold transition-all duration-200 transform hover:scale-105">➕ New Bill (Ctrl+Shift+N)</button>
                            </div>
                            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                                <h3 className="font-bold text-lg mb-3">Settings</h3>
                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Currency</label>
                                        <select value={currency} onChange={(e) => setCurrency(e.target.value)} className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" disabled={isInvoiceFinalized}>
                                            <option value="₹">INR (₹)</option><option value="$">USD ($)</option><option value="€">EUR (€)</option><option value="£">GBP (£)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Previous Balance (Optional)</label>
                                        <input type="text" value={previousBalance} onChange={(e) => { const val = e.target.value; if (/^\d*\.?\d*$/.test(val)) { setPreviousBalance(val); } }} className="w-full p-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" placeholder="Enter previous due" disabled={isInvoiceFinalized} />
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                                <h3 className="font-bold text-lg mb-3">Shortcuts</h3>
                                <ul className="space-y-2 text-sm">
                                    {[ { key: '+', action: 'Add & Go to Price' }, { key: 'Ctrl + Enter', action: 'Add New Item' }, { key: 'Ctrl + ↑', action: 'Copy Name Above' }, { key: 'Enter', action: 'Next Field' }, { key: '↑ / ↓', action: 'Navigate Rows' }, { key: 'Ctrl + F', action: 'Finalize Bill' }, { key: 'Ctrl + P', action: 'Print Bill' }, { key: 'Ctrl + Shift + N', action: 'New Bill' }, { key: 'Esc', action: 'Focus/Close' }, ].map(shortcut => (<li key={shortcut.action} className="flex justify-between items-center text-gray-600 dark:text-gray-400"><span>{shortcut.action}</span><kbd className="px-2 py-1 text-xs font-semibold text-gray-700 bg-gray-100 dark:bg-gray-900 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md">{shortcut.key}</kbd></li>))}
                                </ul>
                            </div>
                        </div>
                        <div className="lg:col-span-3">
                            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">Items</h2>
                                    <button onClick={addItem} disabled={isInvoiceFinalized} className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed">+ Add Item (Ctrl+Enter)</button>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full border-collapse text-sm">
                                        <thead><tr className="bg-gray-50 dark:bg-gray-700/50"><th className="border-b dark:border-gray-700 p-2 text-left">#</th><th className="border-b dark:border-gray-700 p-2 text-left w-2/5">Name</th><th className="border-b dark:border-gray-700 p-2 text-center">Qty</th><th className="border-b dark:border-gray-700 p-2 text-right">Price</th><th className="border-b dark:border-gray-700 p-2 text-right">Total</th><th className="border-b dark:border-gray-700 p-2 text-center">Action</th></tr></thead>
                                        <tbody>
                                            {items.map((item, index) => (
                                                <tr key={item.id} className="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                                    <td className="border-b dark:border-gray-700 p-2 font-medium">{index + 1}</td>
                                                    <td className="border-b dark:border-gray-700 p-1"><input ref={el => itemRefs.current[`${item.id}-name`] = el} type="text" value={item.name} onChange={(e) => updateItemTotal(item.id, 'name', e.target.value)} onKeyDown={(e) => handleItemKeyDown(e, item, 'name')} className="w-full p-1 bg-transparent border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="Product name" disabled={isInvoiceFinalized}/></td>
                                                    <td className="border-b dark:border-gray-700 p-1"><input ref={el => itemRefs.current[`${item.id}-quantity`] = el} type="number" min="1" value={item.quantity} onChange={(e) => updateItemTotal(item.id, 'quantity', e.target.value)} onKeyDown={(e) => handleItemKeyDown(e, item, 'quantity')} onFocus={(e) => e.target.select()} className="w-16 p-1 bg-transparent border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 text-center" disabled={isInvoiceFinalized}/></td>
                                                    <td className="border-b dark:border-gray-700 p-1"><input ref={el => itemRefs.current[`${item.id}-price`] = el} type="number" min="0" step="0.01" value={item.price} onChange={(e) => updateItemTotal(item.id, 'price', e.target.value)} onKeyDown={(e) => handleItemKeyDown(e, item, 'price')} onFocus={(e) => e.target.select()} className="w-24 p-1 bg-transparent border border-gray-300 dark:border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 text-right" disabled={isInvoiceFinalized}/></td>
                                                    <td className="border-b dark:border-gray-700 p-2 font-medium text-right">{currency}{item.total.toFixed(2)}</td>
                                                    <td className="border-b dark:border-gray-700 p-2 text-center"><button onClick={() => removeItem(item.id)} className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded-full text-xs font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled={items.length <= 1 || isInvoiceFinalized}>✕</button></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="mt-4 bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border-t-2 border-blue-500 dark:border-blue-400">
                                    <div className="flex justify-between items-start">
                                        <div className="text-sm text-gray-500 dark:text-gray-400"><p>Items: {items.length}</p><p>Customer: {customerName || 'Walk-in Customer'}</p></div>
                                        <div className="text-right space-y-2">
                                            <div className="text-lg"><span className="text-gray-500 dark:text-gray-400">Current Bill: </span><span className="font-semibold">{currency}{itemsTotal.toFixed(2)}</span></div>
                                            <div className="text-lg"><span className="text-gray-500 dark:text-gray-400">Previous Due: </span><span className="font-semibold">{currency}{Number(previousBalance || 0).toFixed(2)}</span></div>
                                            <hr className="border-gray-300 dark:border-gray-600"/>
                                            <div className="text-3xl font-bold text-green-600 dark:text-green-400">{currency}{grandTotal.toFixed(2)}</div>
                                            <div className="text-sm text-gray-500 dark:text-gray-400 -mt-1">Grand Total</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {notification && (<div className={`fixed bottom-5 left-1/2 -translate-x-1/2 text-white py-2 px-4 rounded-lg shadow-lg animate-bounce ${notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'}`}>{notification.message}</div>)}
                <div className="fixed bottom-4 right-4 bg-white dark:bg-gray-800 rounded-full p-3 shadow-lg border border-gray-200 dark:border-gray-700">
                    <div className="flex items-center gap-2">
                        <div className={`w-3 h-3 rounded-full transition-colors ${isInvoiceFinalized ? 'bg-green-500 animate-pulse' : 'bg-blue-500'}`}></div>
                        <div className="text-xs">{isInvoiceFinalized ? 'Ready to Print' : 'Editing Bill'}</div>
                    </div>
                </div>
            </div>
          </>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>

